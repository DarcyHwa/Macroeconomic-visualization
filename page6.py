import pygwalker as pyg
import pandas as pd
import streamlit.components.v1 as components
import streamlit as st


def app():
    # 调整Streamlit页面的宽度
    st.set_page_config(
        page_title="在Streamlit中使用PyGWalker",
        layout="wide"
    )
    
    # 添加标题
    st.title("在Streamlit中使用PyGWalker")
    
    # 导入你的数据
    df = pd.read_csv("https://kanaries-app.s3.ap-northeast-1.amazonaws.com/public-datasets/bike_sharing_dc.csv")
    
    # 粘贴复制的PyGWalker图表代码
    vis_spec = r"""{"config":[{"config":{"defaultAggregated":true,"geoms":["line"],"coordSystem":"generic","limit":-1,"timezoneDisplayOffset":0},"encodings":{"dimensions":[{"dragId":"gw_RJLz","fid":"date","name":"date","basename":"date","semanticType":"nominal","analyticType":"dimension","offset":0},{"dragId":"gw__mz-","fid":"month","name":"month","basename":"month","semanticType":"quantitative","analyticType":"dimension","offset":0},{"dragId":"gw_CUP5","fid":"season","name":"season","basename":"season","semanticType":"nominal","analyticType":"dimension","offset":0},{"dragId":"gw_fR9w","fid":"year","name":"year","basename":"year","semanticType":"quantitative","analyticType":"dimension","offset":0},{"dragId":"gw_5bvz","fid":"holiday","name":"holiday","basename":"holiday","semanticType":"nominal","analyticType":"dimension","offset":0},{"dragId":"gw_7GqX","fid":"work yes or not","name":"work yes or not","basename":"work yes or not","semanticType":"quantitative","analyticType":"dimension","offset":0},{"dragId":"gw_iNIp","fid":"am or pm","name":"am or pm","basename":"am or pm","semanticType":"nominal","analyticType":"dimension","offset":0},{"dragId":"gw_qwvC","fid":"Day of the week","name":"Day of the week","basename":"Day of the week","semanticType":"quantitative","analyticType":"dimension","offset":0},{"fid":"gw_paint_fid","dragId":"gw_paint_fid","analyticType":"dimension","name":"Paint Field","semanticType":"nominal","computed":true,"expression":{"op":"paint","as":"gw_paint_fid","params":[{"type":"newmap","value":{"dict":{"1":{"name":"L_1","color":"#4c78a8"},"2":{"name":"L_2","color":"#f58518"},"3":{"name":"L_3","color":"#e45756"},"4":{"name":"L_4","color":"#72b7b2"},"5":{"name":"L_5","color":"#54a24b"},"6":{"name":"L_6","color":"#eeca3b"},"7":{"name":"L_7","color":"#b279a2"},"8":{"name":"L_8","color":"#ff9da6"},"9":{"name":"L_9","color":"#9d755d"},"10":{"name":"L_10","color":"#bab0ac"}},"facets":[{"map":"7cExAQAAAMKg9U9tDB+gAAAAAAAAAAAAAAAAAAAAgLcB","dimensions":[{"domain":{"type":"quantitative","value":[0,977],"width":128},"fid":"count"},{"domain":{"type":"quantitative","value":[0,12],"width":128},"fid":"month"}],"usedColor":[1]}],"usedColor":[1]}}]}},{"dragId":"gw_mea_key_fid","fid":"gw_mea_key_fid","name":"Measure names","analyticType":"dimension","semanticType":"nominal"}],"measures":[{"dragId":"gw_hO0u","fid":"hour","name":"hour","basename":"hour","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"dragId":"gw_jhlR","fid":"temperature","name":"temperature","basename":"temperature","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"dragId":"gw_2vOt","fid":"feeling_temp","name":"feeling_temp","basename":"feeling_temp","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"dragId":"gw_zKjz","fid":"humidity","name":"humidity","basename":"humidity","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"dragId":"gw_Jin7","fid":"winspeed","name":"winspeed","basename":"winspeed","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"dragId":"gw_CeKF","fid":"casual","name":"casual","basename":"casual","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"dragId":"gw_725K","fid":"registered","name":"registered","basename":"registered","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"dragId":"gw_KEef","fid":"count","name":"count","basename":"count","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"dragId":"gw_count_fid","fid":"gw_count_fid","name":"Row count","analyticType":"measure","semanticType":"quantitative","aggName":"sum","computed":true,"expression":{"op":"one","params":[],"as":"gw_count_fid"}},{"dragId":"gw_mea_val_fid","fid":"gw_mea_val_fid","name":"Measure values","analyticType":"measure","semanticType":"quantitative","aggName":"sum"}],"rows":[{"dragId":"gw_p9c4","fid":"count","name":"count","basename":"count","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0},{"dragId":"gw_jcgo","fid":"casual","name":"casual","basename":"casual","analyticType":"measure","semanticType":"quantitative","aggName":"sum","offset":0}],"columns":[{"dragId":"gw_sfjx","fid":"month","name":"month","basename":"month","semanticType":"quantitative","analyticType":"dimension","offset":0}],"color":[{"fid":"gw_paint_fid","dragId":"auto_gw_paint_fid","analyticType":"dimension","name":"Paint Field","semanticType":"nominal","computed":true,"expression":{"op":"paint","as":"gw_paint_fid","params":[{"type":"newmap","value":{"dict":{"1":{"name":"L_1","color":"#4c78a8"},"2":{"name":"L_2","color":"#f58518"},"3":{"name":"L_3","color":"#e45756"},"4":{"name":"L_4","color":"#72b7b2"},"5":{"name":"L_5","color":"#54a24b"},"6":{"name":"L_6","color":"#eeca3b"},"7":{"name":"L_7","color":"#b279a2"},"8":{"name":"L_8","color":"#ff9da6"},"9":{"name":"L_9","color":"#9d755d"},"10":{"name":"L_10","color":"#bab0ac"}},"facets":[{"map":"7cExAQAAAMKg9U9tDB+gAAAAAAAAAAAAAAAAAAAAgLcB","dimensions":[{"domain":{"type":"quantitative","value":[0,977],"width":128},"fid":"count"},{"domain":{"type":"quantitative","value":[0,12],"width":128},"fid":"month"}],"usedColor":[1]}],"usedColor":[1]}}]}}],"opacity":[],"size":[],"shape":[],"radius":[],"theta":[],"longitude":[],"latitude":[],"geoId":[],"details":[],"filters":[],"text":[]},"layout":{"showActions":true,"showTableSummary":false,"stack":"stack","interactiveScale":false,"zeroScale":true,"size":{"mode":"fixed","width":672,"height":563},"format":{},"geoKey":"name","resolve":{"x":false,"y":false,"color":false,"opacity":false,"shape":false,"size":false}},"visId":"gw_6pbU","name":"Chart 1"}],"chart_map":{},"workflow_list":[{"workflow":[{"type":"transform","transform":[{"key":"gw_paint_fid","expression":{"op":"paint","as":"gw_paint_fid","params":[{"type":"newmap","value":{"facets":[{"dimensions":[{"domain":{"type":"quantitative","value":[0,977],"width":128},"fid":"count"},{"domain":{"type":"quantitative","value":[0,12],"width":128},"fid":"month"}],"map":"7cExAQAAAMKg9U9tDB+gAAAAAAAAAAAAAAAAAAAAgLcB"}],"dict":{"1":{"name":"L_1"}}}}]}}]},{"type":"view","query":[{"op":"aggregate","groupBy":["month","gw_paint_fid"],"measures":[{"field":"count","agg":"sum","asFieldKey":"count_sum"},{"field":"casual","agg":"sum","asFieldKey":"casual_sum"}]}]}]}],"version":"0.4.7"}"""
    
    # 使用PyGWalker生成HTML
    pyg_html = pyg.to_html(df, spec=vis_spec)
    
    # 将HTML嵌入到Streamlit应用程序中
    components.html(pyg_html, height=1000, scrolling=True)